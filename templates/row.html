{% extends "digital-land-frontend/dlf-base.html" %}
{%- from "digital-land-frontend/components/map/macro.html" import dlMap %}
{%- from "digital-land-frontend/components/data-record/macro.html" import dlDataRecordPanel %}

{% set row_name = row['name'] if row['name'] else row['slug'] %}

{% block head %}
{{ super() }}
<!-- include css and js for LeafletJS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
  integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
  crossorigin=""/>

<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
  integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
  crossorigin=""></script>


<script src="{{ staticPath|default('/static') }}/javascripts/dl-maps.js"></script>

{% endblock  %}

{%- block beforeContent -%}
    {{ super() }}

    {{- govukBreadcrumbs({
    "items": [
        {
        "text": "Digital Land",
        "href": "/"
        },
        {
        "text": data_type|capitalize,
        "href": urlRoot
        },
        {
        "text": row_name|truncate(30)
        }
    ]
    }) -}}
{%- endblock -%}

{% block content %}

<span class="govuk-caption-xl">{{ data_type }}</span>
<h1 class="govuk-heading-xl">{{ row_name }}</h1>

{% set areaproperties %}
{% for i in row.keys() %}
{% if i not in ["id", "resource", "geometry", "has_geometry"] %}
<div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
    {{ i }}
    </dt>
    <dd class="govuk-summary-list__value">
    {% if i == "organisation" %}
    <a href="https://digital-land.github.io/organisation/{{row[i]|replace(':','/')}}" class="govuk-link">{{ row[i]|organisation_id_to_name }}</a>
    <span title="Key in organisation dataset: {{ row[i] }}" class="govuk-!-font-size-16 secondary-text data-reference">(<span class="govuk-visually-hidden">Key in the organisation dataset is </span>{{ row[i] }})</span>
    {% else %}
    {{ row[i] }}
    {% endif %}
    </dd>
</div>
{% endif %}
{% endfor %}
{% endset %}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        {{ dlDataRecordPanel({
            "identifier": row['site'] if row['site'] else row['slug'],
            "resource": {
                "identifier": row['resource'],
                "url": "https://github.com/digital-land/" + data_type + "-collection/tree/main/transformed/" + data_type + "/" + row['resource'] + ".csv"
            },
            "html": areaproperties
        }) }}
    </div>
</div>

{% if row["has_geometry"] %}
{{ dlMap({
    "id": "aMap",
    "classes": "govuk-!-margin-top-4 govuk-!-margin-bottom-2",
    "attributes": {
        "data-geojson-urls": "geometry.geojson"
    },
    "height": "460"
}) }}
{% endif %}

{% endblock %}

{% block bodyEnd %}
{{ super() }}
<script>
    const $mapElement = document.querySelector('[data-module="boundary-map"]')
    const mapComponent = new DLMaps.Map($mapElement).init({})
</script>
{% endblock %}
